# AutoVend 用户使用手册

## 1. 系统概述

AutoVend 是一个智能汽车销售AI代理系统，旨在通过分析聊天记录，自动提取用户信息并分析购车需求，为客户提供个性化的汽车推荐服务。本系统能够智能地区分显性需求和隐性需求，并根据用户特征标签提供精准的购车建议。

## 2. 系统访问

### 2.1 API访问

系统提供RESTful API接口，可通过以下方式访问：

- 基础URL: `http://{server_host}:{port}/api`
- API文档: `http://{server_host}:{port}/docs`

### 2.2 权限要求

- 基础查询：无需特殊权限
- 用户画像管理：需要管理员权限
- 系统配置：需要管理员权限

## 3. 主要功能

### 3.1 聊天对话

#### 3.1.1 创建新会话

**请求方式**：POST `/api/chat/new`

**参数**：
- `phone_number`: 用户电话号码（可选）

**示例**：
```json
{
  "phone_number": "13800138000"
}
```

**响应**：
```json
{
  "session_id": "f8d7e9c3-5b2a-4c1a-8f9e-3a6b2c5d4e7f",
  "messages": [
    {
      "message_id": "a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6d",
      "content": "您好！欢迎来到AutoVend。我该如何称呼您？先生、女士或小姐？",
      "sender": "system",
      "timestamp": "2023-11-20T15:30:45.123456"
    }
  ],
  "profile_id": null,
  "stage": "welcome"
}
```

#### 3.1.2 发送消息

**请求方式**：POST `/api/chat/{session_id}/message`

**参数**：
- `session_id`: 会话ID（路径参数）
- `content`: 消息内容
- `sender`: 发送者（默认为"user"）

**示例**：
```json
{
  "content": "您好，我是张先生，我想买一辆SUV，预算在30万左右。"
}
```

**响应**：
```json
{
  "session_id": "f8d7e9c3-5b2a-4c1a-8f9e-3a6b2c5d4e7f",
  "messages": [
    {
      "message_id": "a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6d",
      "content": "您好！欢迎来到AutoVend。我该如何称呼您？先生、女士或小姐？",
      "sender": "system",
      "timestamp": "2023-11-20T15:30:45.123456"
    },
    {
      "message_id": "b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d7e",
      "content": "您好，我是张先生，我想买一辆SUV，预算在30万左右。",
      "sender": "user",
      "timestamp": "2023-11-20T15:31:15.654321"
    },
    {
      "message_id": "c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e8f",
      "content": "张先生您好！非常感谢您的信息。请问这辆SUV主要是您本人使用，还是为家人购买？",
      "sender": "system",
      "timestamp": "2023-11-20T15:31:16.123456"
    }
  ],
  "profile_id": "e9f8d7c6-5b4a-3c2a-1f9e-7a6b4c5d2e3f",
  "stage": "welcome"
}
```

#### 3.1.3 获取会话信息

**请求方式**：GET `/api/chat/{session_id}`

**参数**：
- `session_id`: 会话ID（路径参数）

**响应**：与发送消息响应格式相同

### 3.2 用户画像管理

#### 3.2.1 获取用户画像

**请求方式**：GET `/api/profile/{profile_id}`

**参数**：
- `profile_id`: 用户画像ID（路径参数）

**响应**：
```json
{
  "profile_id": "e9f8d7c6-5b4a-3c2a-1f9e-7a6b4c5d2e3f",
  "phone_number": "13800138000",
  "age": "30-40",
  "user_title": "Mr.",
  "name": "张",
  "target_driver": "Self",
  "expertise": 3,
  "family_size": 3,
  "price_sensitivity": "Medium",
  "residence": "中国+北京+朝阳",
  "parking_conditions": "Allocated Parking Space",
  "tags": {
    "Age Group": "Middle-aged",
    "Tech Comfort": "Medium",
    "Urban Driving": "High",
    "Parking Ease": "High, Implicit"
  },
  "connections": [],
  "created_at": "2023-11-20T15:31:15.654321",
  "updated_at": "2023-11-20T15:35:22.123456"
}
```

#### 3.2.2 更新用户画像

**请求方式**：PATCH `/api/profile/{profile_id}`

**参数**：
- `profile_id`: 用户画像ID（路径参数）
- 需要更新的字段及其值

**示例**：
```json
{
  "family_size": 4,
  "residence": "中国+上海+浦东"
}
```

**响应**：更新后的完整用户画像

#### 3.2.3 添加用户关联

**请求方式**：POST `/api/profile/{profile_id}/connection`

**参数**：
- `profile_id`: 用户画像ID（路径参数）
- `connection_phone_number`: 关联用户的电话号码
- `connection_id_relationship`: 关联关系描述

**示例**：
```json
{
  "connection_phone_number": "13900139000",
  "connection_id_relationship": "妻子"
}
```

**响应**：更新后的完整用户画像

### 3.3 需求管理

#### 3.3.1 获取需求信息

**请求方式**：GET `/api/needs/{profile_id}`

**参数**：
- `profile_id`: 用户画像ID（路径参数）

**响应**：
```json
{
  "profile_id": "e9f8d7c6-5b4a-3c2a-1f9e-7a6b4c5d2e3f",
  "needs": {
    "budget": "300000",
    "vehicle_category_bottom": ["SUV"],
    "brand": ["Toyota", "Honda"],
    "size": "Medium, Implicit",
    "safety_features": ["Advanced Safety Package, Implicit"]
  }
}
```

#### 3.3.2 添加需求

**请求方式**：POST `/api/needs/{profile_id}`

**参数**：
- `profile_id`: 用户画像ID（路径参数）
- `category`: 需求类别
- `value`: 需求值
- `is_implicit`: 是否为隐性需求（默认为false）

**示例**：
```json
{
  "category": "color",
  "value": "Black",
  "is_implicit": false
}
```

**响应**：更新后的完整需求信息

#### 3.3.3 删除需求

**请求方式**：DELETE `/api/needs/{profile_id}/{category}`

**参数**：
- `profile_id`: 用户画像ID（路径参数）
- `category`: 需求类别（路径参数）
- `value`: 需求值（查询参数，针对列表类型的需求）

**示例**：
```
DELETE /api/needs/e9f8d7c6-5b4a-3c2a-1f9e-7a6b4c5d2e3f/brand?value=Honda
```

**响应**：更新后的完整需求信息

## 4. 管理员功能

### 4.1 离线补充用户画像

管理员可以通过用户画像API为已完成线下流程的客户补充或修改信息：

1. 使用GET请求获取现有用户画像
2. 使用PATCH请求更新用户画像中的字段
3. 系统会自动根据更新的信息重新生成标签

### 4.2 查看系统统计信息

管理员可以查看系统运行统计信息，包括：

- 活跃会话数量
- 用户画像总数
- 需求标签分布
- 推荐车型统计

## 5. 最佳实践

### 5.1 对话技巧

- **提供清晰信息**：明确表述预算、偏好的品牌、车型等需求
- **回答系统提问**：系统会提出有针对性的问题，回答这些问题可以帮助系统更好地了解您的需求
- **随时更新需求**：您可以在对话过程中随时更新或修改您的需求

### 5.2 系统特性

- **动态用户画像**：系统会根据对话内容动态更新您的用户画像
- **隐性需求推断**：系统能够推断您未明确表述但可能存在的需求
- **个性化推荐**：基于您的显性和隐性需求提供个性化的车型推荐

## 6. 故障排除

### 6.1 常见问题

1. **系统未响应**：检查网络连接，刷新页面或重新启动应用
2. **会话ID失效**：创建新的会话
3. **推荐不符合预期**：提供更多具体需求，或明确表示拒绝某些推荐类型

### 6.2 联系支持

如遇技术问题，请联系系统管理员或技术支持团队：

- 邮箱：support@autovend.com
- 电话：400-123-4567

## 7. 隐私政策

AutoVend 重视用户隐私保护：

- 所有用户数据均会加密存储
- 用户信息仅用于提供汽车推荐服务
- 未经用户授权，不会将用户信息用于其他用途或分享给第三方

## 8. 更新日志

### 版本 0.1.0 (2023-11-20)

- 初始版本发布
- 实现基本对话功能
- 支持用户画像提取和需求分析
- 提供简单的车型推荐功能 