# AutoVend 功能测试计划

## 1. 测试范围

本测试计划涵盖 AutoVend 智能汽车销售AI代理系统的功能测试，主要包括以下模块：

- 用户画像提取
- 购车需求分析
- 对话流程管理
- 车型推荐功能
- API接口

## 2. 测试环境

- **开发环境**：Python 3.10, FastAPI 0.104.1
- **测试工具**：pytest, requests, pytest-cov
- **测试数据**：模拟对话数据集
- **部署环境**：Docker容器

## 3. 测试策略

### 3.1 单元测试

针对系统中的各个模块和函数进行独立测试，确保每个组件的功能正确性。

### 3.2 集成测试

测试模块之间的交互，确保系统作为一个整体能够正常工作。

### 3.3 端到端测试

模拟完整的用户对话流程，验证系统能否正确处理用户请求并提供适当的响应。

### 3.4 性能测试

测试系统在高负载下的性能表现，确保能够满足实际使用需求。

## 4. 测试用例

### 4.1 用户画像模块测试

#### TC-UP-001: 基本信息提取测试

- **描述**：测试系统能否从对话中正确提取用户基本信息
- **前置条件**：已准备好包含各类用户信息的测试对话文本
- **测试步骤**：
  1. 调用信息提取函数处理测试文本
  2. 验证返回的用户信息是否符合预期
- **预期结果**：系统能够正确提取年龄、性别、职业等基本信息

#### TC-UP-002: 用户标签生成测试

- **描述**：测试系统能否根据用户画像生成相应的标签
- **前置条件**：已准备好完整的用户画像数据
- **测试步骤**：
  1. 调用标签生成函数处理用户画像
  2. 验证生成的标签是否合理
- **预期结果**：生成的标签应与用户特征相符

#### TC-UP-003: 用户关联识别测试

- **描述**：测试系统能否识别用户为他人购车的场景
- **前置条件**：已准备好包含购车关联信息的测试对话文本
- **测试步骤**：
  1. 调用关联识别函数处理测试文本
  2. 验证系统能否正确识别为他人购车的情况
- **预期结果**：系统能够识别出用户为家人/朋友购车的情况，并记录关联信息

### 4.2 需求分析模块测试

#### TC-NA-001: 显性需求提取测试

- **描述**：测试系统能否从对话中提取显性需求
- **前置条件**：已准备好包含各类显性需求的测试对话文本
- **测试步骤**：
  1. 调用需求提取函数处理测试文本
  2. 验证返回的需求信息是否符合预期
- **预期结果**：系统能够正确提取预算、品牌偏好等显性需求

#### TC-NA-002: 隐性需求推断测试

- **描述**：测试系统能否根据用户画像和对话内容推断隐性需求
- **前置条件**：已准备好用户画像和显性需求数据
- **测试步骤**：
  1. 调用隐性需求推断函数
  2. 验证推断的隐性需求是否合理
- **预期结果**：推断的隐性需求应与用户特征和显性需求相符

#### TC-NA-003: 需求冲突处理测试

- **描述**：测试系统能否处理需求之间的冲突
- **前置条件**：已准备好包含冲突需求的测试数据
- **测试步骤**：
  1. 调用需求添加函数添加冲突的需求
  2. 验证系统是否按照预期处理冲突
- **预期结果**：系统应遵循后表述覆盖先表述的原则处理冲突

### 4.3 对话管理模块测试

#### TC-DM-001: 会话创建测试

- **描述**：测试系统能否正确创建新的聊天会话
- **测试步骤**：
  1. 调用会话创建API
  2. 验证返回的会话信息是否完整
- **预期结果**：系统应返回包含会话ID和欢迎消息的响应

#### TC-DM-002: 消息处理测试

- **描述**：测试系统能否正确处理用户消息
- **前置条件**：已创建测试会话
- **测试步骤**：
  1. 向会话发送测试消息
  2. 验证系统是否能提取信息并生成适当回复
- **预期结果**：系统应能提取消息中的信息并生成有意义的回复

#### TC-DM-003: 状态转换测试

- **描述**：测试对话状态能否正确转换
- **前置条件**：已创建处于特定阶段的测试会话
- **测试步骤**：
  1. 发送触发状态转换的消息
  2. 验证会话状态是否转换到预期阶段
- **预期结果**：会话状态应根据对话内容正确转换

### 4.4 车型推荐模块测试

#### TC-CR-001: 基本推荐测试

- **描述**：测试系统能否根据需求推荐合适的车型
- **前置条件**：已准备好用户需求数据
- **测试步骤**：
  1. 调用推荐函数处理需求数据
  2. 验证推荐的车型是否符合需求
- **预期结果**：推荐的车型应符合用户的主要需求

#### TC-CR-002: 个性化排序测试

- **描述**：测试系统能否根据用户偏好对推荐结果进行排序
- **前置条件**：已准备好用户画像和需求数据
- **测试步骤**：
  1. 调用推荐函数并启用个性化排序
  2. 验证排序结果是否符合用户偏好
- **预期结果**：排序靠前的车型应更符合用户的核心需求和偏好

### 4.5 API接口测试

#### TC-API-001: 创建聊天会话

- **描述**：测试创建新聊天会话的API
- **测试步骤**：
  1. 发送POST请求至 `/api/chat/new`
  2. 验证返回的响应码和会话信息
- **预期结果**：应返回200状态码和有效的会话信息

#### TC-API-002: 发送聊天消息

- **描述**：测试发送聊天消息的API
- **前置条件**：已创建测试会话
- **测试步骤**：
  1. 发送POST请求至 `/api/chat/{session_id}/message`
  2. 验证返回的响应码和系统回复
- **预期结果**：应返回200状态码和系统的回复消息

#### TC-API-003: 获取用户画像

- **描述**：测试获取用户画像的API
- **前置条件**：已创建测试用户画像
- **测试步骤**：
  1. 发送GET请求至 `/api/profile/{profile_id}`
  2. 验证返回的响应码和用户画像信息
- **预期结果**：应返回200状态码和完整的用户画像信息

## 5. 测试数据准备

### 5.1 模拟对话数据集

创建一系列模拟对话，包括但不限于以下场景：

- 用户直接表述个人信息和需求
- 用户为家人/朋友购车
- 用户有明确的品牌和预算偏好
- 用户只有模糊的需求描述
- 用户在对话过程中改变需求

### 5.2 用户画像数据

准备多种类型的用户画像测试数据，覆盖不同年龄段、职业、家庭情况等特征。

### 5.3 车型数据

准备多种类型的车型数据，包括不同品牌、类型、价格区间的车型，用于测试推荐功能。

## 6. 测试执行计划

### 6.1 测试准备

- 搭建测试环境
- 准备测试数据
- 配置测试工具

### 6.2 测试执行

- 执行单元测试，确保各模块功能正确
- 执行集成测试，验证模块间交互
- 执行端到端测试，验证完整流程
- 执行性能测试，确保系统稳定性

### 6.3 缺陷管理

- 记录测试过程中发现的问题
- 跟踪问题修复进度
- 执行回归测试，确保修复有效

## 7. 测试报告

测试完成后，将生成详细的测试报告，包括：

- 测试覆盖率统计
- 通过/失败测试用例统计
- 发现的问题汇总
- 系统性能指标
- 改进建议

## 8. 测试自动化

为提高测试效率和可重复性，计划实现以下自动化测试：

- 单元测试自动化：使用pytest框架
- API测试自动化：使用requests库和pytest
- 覆盖率统计：使用pytest-cov插件
- 集成到CI/CD流程：在代码提交时自动执行测试 